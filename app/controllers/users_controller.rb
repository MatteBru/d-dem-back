class UsersController < ApplicationController
  before_action :set_user, only: [:show, :update, :destroy]


  # GET /users
  def index
    @users = User.all

    render json: @users
  end

  # GET /users/1
  def show
    render json: @user
  end

  # POST /users
  def create
    byebug

    state = params[:district][:state]
    dist = params[:district][:cdid].sub(/^0/, "")

    @district = District.find_or_create_by(state: state, cdid: dist, rep: dist_find(state, dist))

    @user = User.new(user_params)
    @user.district = @district

    if @user.save
      token = issue_token(@user)
      render json: {user: UserSerializer.new(@user).attributes, jwt: token}, status: :created, location: @user
    else
      render json: {errors: @user.errors}, status: :unprocessable_entity
    end
  end

  # PATCH/PUT /users/1
  def update
    if @user.update(user_params)
      render json: @user
    else
      render json: @user.errors, status: :unprocessable_entity
    end
  end

  # DELETE /users/1
  def destroy
    @user.destroy
  end

  private
    # Use callbacks to share common setup or constraints between actions.
    def set_user
      @user = User.find(params[:id])
    end

    # Only allow a trusted parameter "white list" through.
    def user_params
      params.require(:user).permit(:name, :username, :address, :phone, :email, :password)
    end

    def dist_find(state, dist)
      @dist_map = [{"AL"=>[{"4"=>3}, {"5"=>39}, {"1"=>49}, {"6"=>298}, {"2"=>326}, {"3"=>329}, {"7"=>364}]}, {"AK"=>[{"AL"=>433}]}, {"AZ"=>[{"5"=>21}, {"8"=>137}, {"7"=>143}, {"4"=>152}, {"3"=>162}, {"2"=>271}, {"1"=>293}, {"6"=>357}, {"9"=>370}]}, {"AR"=>[{"1"=>86}, {"2"=>178}, {"4"=>422}, {"3"=>427}]}, {"CA"=>[{"31"=>4}, {"44"=>14}, {"37"=>16}, {"7"=>18}, {"26"=>41}, {"42"=>50}, {"24"=>52}, {"29"=>53}, {"27"=>62}, {"8"=>79}, {"46"=>81}, {"16"=>82}, {"53"=>97}, {"10"=>104}, {"11"=>107}, {"18"=>122}, {"3"=>144}, {"34"=>149}, {"2"=>184}, {"50"=>187}, {"49"=>189}, {"17"=>210}, {"25"=>218}, {"1"=>224}, {"13"=>233}, {"33"=>237}, {"19"=>241}, {"47"=>245}, {"6"=>260}, {"23"=>261}, {"4"=>263}, {"9"=>270}, {"32"=>285}, {"22"=>292}, {"20"=>299}, {"12"=>304}, {"52"=>307}, {"48"=>330}, {"40"=>340}, {"39"=>341}, {"36"=>342}, {"38"=>349}, {"28"=>354}, {"30"=>366}, {"14"=>380}, {"15"=>385}, {"41"=>386}, {"5"=>391}, {"35"=>397}, {"21"=>402}, {"51"=>403}, {"45"=>413}, {"43"=>416}]}, {"CO"=>[{"4"=>43}, {"6"=>69}, {"1"=>99}, {"5"=>225}, {"7"=>305}, {"2"=>314}, {"3"=>394}]}, {"CT"=>[{"2"=>84}, {"3"=>101}, {"5"=>125}, {"4"=>179}, {"1"=>229}]}, {"DE"=>[{"AL"=>30}]}, {"FL"=>[{"12"=>22}, {"16"=>42}, {"14"=>58}, {"13"=>87}, {"26"=>92}, {"10"=>103}, {"6"=>106}, {"22"=>109}, {"25"=>110}, {"2"=>118}, {"21"=>136}, {"1"=>141}, {"20"=>171}, {"5"=>232}, {"18"=>259}, {"7"=>283}, {"8"=>315}, {"19"=>332}, {"17"=>333}, {"27"=>334}, {"15"=>337}, {"4"=>346}, {"9"=>379}, {"23"=>415}, {"11"=>419}, {"24"=>425}, {"3"=>431}]}, {"GA"=>[{"12"=>5}, {"2"=>25}, {"1"=>56}, {"9"=>72}, {"3"=>129}, {"14"=>158}, {"6"=>167}, {"10"=>175}, {"4"=>195}, {"5"=>236}, {"11"=>243}, {"13"=>358}, {"8"=>360}, {"7"=>428}]}, {"HI"=>[{"2"=>140}, {"1"=>166}]}, {"ID"=>[{"1"=>222}, {"2"=>369}]}, {"IL"=>[{"12"=>32}, {"17"=>47}, {"13"=>95}, {"7"=>96}, {"11"=>134}, {"4"=>165}, {"14"=>186}, {"2"=>208}, {"16"=>217}, {"8"=>219}, {"18"=>223}, {"3"=>238}, {"5"=>317}, {"6"=>336}, {"1"=>344}, {"9"=>353}, {"10"=>355}, {"15"=>367}]}, {"IN"=>[{"3"=>11}, {"5"=>38}, {"8"=>44}, {"7"=>54}, {"9"=>181}, {"6"=>276}, {"4"=>331}, {"1"=>407}, {"2"=>412}]}, {"IA"=>[{"1"=>28}, {"4"=>216}, {"2"=>240}, {"3"=>432}]}, {"KS"=>[{"4"=>124}, {"2"=>194}, {"1"=>257}, {"3"=>430}]}, {"KY"=>[{"6"=>13}, {"1"=>74}, {"2"=>164}, {"4"=>258}, {"5"=>328}, {"3"=>429}]}, {"LA"=>[{"5"=>1}, {"6"=>156}, {"3"=>176}, {"4"=>196}, {"2"=>325}, {"1"=>352}]}, {"ME"=>[{"1"=>309}, {"2"=>313}]}, {"MD"=>[{"4"=>40}, {"7"=>91}, {"6"=>100}, {"1"=>169}, {"5"=>182}, {"8"=>318}, {"2"=>343}, {"3"=>351}]}, {"MA"=>[{"7"=>51}, {"5"=>64}, {"9"=>205}, {"4"=>209}, {"8"=>251}, {"2"=>266}, {"6"=>281}, {"1"=>286}, {"3"=>399}]}, {"MI"=>[{"3"=>6}, {"1"=>19}, {"8"=>23}, {"13"=>78}, {"12"=>111}, {"2"=>185}, {"5"=>212}, {"14"=>231}, {"9"=>234}, {"10"=>277}, {"4"=>278}, {"11"=>398}, {"6"=>401}, {"7"=>409}]}, {"MN"=>[{"5"=>119}, {"6"=>120}, {"2"=>235}, {"4"=>264}, {"8"=>289}, {"3"=>301}, {"7"=>308}, {"1"=>414}]}, {"MS"=>[{"3"=>168}, {"1"=>206}, {"4"=>296}, {"2"=>389}]}, {"MO"=>[{"1"=>66}, {"5"=>67}, {"6"=>157}, {"4"=>170}, {"7"=>242}, {"3"=>248}, {"8"=>374}, {"2"=>408}]}, {"MT"=>[{"AL"=>146}]}, {"NE"=>[{"2"=>10}, {"1"=>133}, {"3"=>377}]}, {"NV"=>[{"2"=>7}, {"4"=>211}, {"3"=>335}, {"1"=>395}]}, {"NH"=>[{"2"=>220}, {"1"=>365}]}, {"NJ"=>[{"11"=>138}, {"5"=>153}, {"7"=>226}, {"2"=>239}, {"3"=>252}, {"1"=>290}, {"6"=>297}, {"9"=>300}, {"10"=>302}, {"8"=>371}, {"4"=>373}, {"12"=>417}]}, {"NM"=>[{"3"=>249}, {"1"=>250}, {"2"=>303}]}, {"NY"=>[{"9"=>65}, {"27"=>73}, {"14"=>88}, {"11"=>113}, {"16"=>121}, {"13"=>123}, {"19"=>128}, {"26"=>177}, {"8"=>192}, {"24"=>204}, {"2"=>215}, {"17"=>246}, {"18"=>253}, {"12"=>254}, {"5"=>274}, {"6"=>275}, {"10"=>284}, {"23"=>320}, {"4"=>324}, {"15"=>362}, {"25"=>372}, {"21"=>381}, {"3"=>384}, {"22"=>388}, {"20"=>396}, {"7"=>406}, {"1"=>434}]}, {"NC"=>[{"12"=>2}, {"13"=>45}, {"1"=>48}, {"5"=>135}, {"2"=>180}, {"8"=>183}, {"3"=>200}, {"10"=>267}, {"11"=>272}, {"9"=>310}, {"4"=>316}, {"7"=>339}, {"6"=>411}]}, {"ND"=>[{"AL"=>85}]}, {"OH"=>[{"3"=>17}, {"1"=>60}, {"8"=>94}, {"11"=>139}, {"7"=>147}, {"6"=>197}, {"4"=>201}, {"14"=>202}, {"9"=>203}, {"5"=>230}, {"16"=>322}, {"13"=>347}, {"15"=>383}, {"12"=>393}, {"10"=>400}, {"2"=>421}]}, {"OK"=>[{"1"=>37}, {"4"=>71}, {"3"=>247}, {"2"=>282}, {"5"=>345}]}, {"OR"=>[{"3"=>29}, {"1"=>31}, {"4"=>98}, {"5"=>356}, {"2"=>410}]}, {"PA"=>[{"11"=>12}, {"13"=>33}, {"1"=>35}, {"17"=>57}, {"6"=>83}, {"15"=>105}, {"14"=>114}, {"2"=>126}, {"8"=>130}, {"3"=>207}, {"10"=>256}, {"7"=>273}, {"4"=>306}, {"12"=>338}, {"9"=>368}, {"16"=>378}, {"5"=>390}]}, {"RI"=>[{"1"=>63}, {"2"=>227}]}, {"SC"=>[{"6"=>68}, {"3"=>116}, {"4"=>154}, {"5"=>291}, {"7"=>323}, {"1"=>350}, {"2"=>424}]}, {"SD"=>[{"AL"=>288}]}, {"TN"=>[{"6"=>26}, {"7"=>27}, {"9"=>70}, {"5"=>80}, {"4"=>108}, {"2"=>117}, {"3"=>131}, {"8"=>221}, {"1"=>327}]}, {"TX"=>[{"19"=>8}, {"36"=>9}, {"6"=>15}, {"8"=>34}, {"26"=>46}, {"31"=>55}, {"20"=>59}, {"11"=>76}, {"28"=>89}, {"7"=>90}, {"35"=>112}, {"27"=>127}, {"17"=>132}, {"1"=>148}, {"15"=>150}, {"12"=>155}, {"9"=>159}, {"29"=>160}, {"5"=>173}, {"23"=>188}, {"18"=>190}, {"3"=>198}, {"30"=>199}, {"24"=>255}, {"10"=>262}, {"16"=>294}, {"22"=>295}, {"2"=>312}, {"4"=>319}, {"32"=>363}, {"21"=>375}, {"13"=>392}, {"33"=>404}, {"34"=>405}, {"14"=>418}, {"25"=>423}]}, {"UT"=>[{"1"=>24}, {"3"=>93}, {"4"=>244}, {"2"=>382}]}, {"VT"=>[{"1"=>420}]}, {"VA"=>[{"8"=>20}, {"7"=>36}, {"10"=>75}, {"11"=>77}, {"5"=>145}, {"6"=>151}, {"9"=>161}, {"4"=>265}, {"3"=>359}, {"2"=>387}, {"1"=>426}]}, {"WA"=>[{"1"=>102}, {"10"=>172}, {"3"=>174}, {"7"=>191}, {"6"=>213}, {"2"=>228}, {"5"=>269}, {"4"=>287}, {"8"=>321}, {"9"=>376}]}, {"WV"=>[{"3"=>193}, {"1"=>268}, {"2"=>279}]}, {"WI"=>[{"7"=>115}, {"8"=>142}, {"6"=>163}, {"3"=>214}, {"4"=>280}, {"2"=>311}, {"1"=>348}, {"5"=>361}]}, {"WY"=>[{"AL"=>61}]}]
      @dist_map.find{|s| !!s[state]}[state].find{|d| !!d[dist]}[dist]
    end

end
